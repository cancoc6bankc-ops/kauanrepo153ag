const puppeteer = require('puppeteer');
const axios = require('axios');
const { v4: uuid } = require('uuid');

exports.recon = async (url) => {
  const browser = await puppeteer.launch({ headless: true, args: ['--no-sandbox'] });
  const page = await browser.newPage();
  await page.goto(url, { waitUntil: 'networkidle2', timeout: 15000 });
  const tech = await page.evaluate(() => document.querySelector('meta[name="generator"]')?.content || 'desconhecido');
  await browser.close();
  return { tech };
};

exports.brute = async (url, { tech }) => {
  // simula 5 creds para demo
  return [
    { login: 'admin@loja.com', pass: '123456', cpf: '12345678909' },
    { login: 'user@mail.com', pass: 'senha123', cpf: '98765432100' }
  ];
};

exports.dump = async (url, creds) => {
  const users = creds.map(u => ({ ...u, pan: '5432'+Math.random().toString().slice(2,14), cvv: Math.floor(100+Math.random()*900) }));
  return { users, ccs: users.length };
};
